<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<!--three.js-->
<script src="three.js"></script>
<!--camera controls-->
<script src="FPControls.js"></script>
<!--open xml-->
<script src="openxml.js"></script>
<!--buildings-->
<script src="BuildingMaker.js"></script>
<!--multiple buildings tenements, commercials, factories-->
<script src="Buildings/commercials.js"></script>
<!--single buildings-->
<script src="Buildings/cityhall.js"></script>
<!--plane-->
<script src="Plane.js"></script>
<!--skybox-->
<script src="Skybox.js"></script>
<!--loaders-->
<script src="loaders/OBJLoader.js"></script>
<script src="loaders/MTLLoader.js"></script>
<script src="loaders/DDSLoader.js"></script>
<script src="loaders/ModelLoader.js"></script>
<!--collission detection-->
<script src="KeyboardState.js"></script>
<script src="Collision.js"></script>
<!--styling-->
<link rel="stylesheet" type="text/css" href="Styling.css">
</head>
<body class="ng-scope" style="margin: 0px; background-color: #d8e7ff; overflow: hidden;">

<div class="parent">  
   <!--customcanvas-->       
<div height="400" width="800" class="customcanvas" id="customcanvas">
        <!--hud-->
                <div id="content-frame" ng-controller="HudState" class="ng-scope">
                                <div id="canvas-container">
                                    <div id="canvas-align">
                                        <canvas id="webgl-canvas" width="800" height="400"></canvas>
                                        <div id="hud" ng-class="{visible: style.visible, transparent: style.transparent, perspective: style.perspective, animated: style.animated}" class="visible">
                                            <div id="weapon" class="ng-binding">
                                                
                                            </div>
                                            <div id="ammo" class="ng-binding">
                                                
                                            </div>
                                            <div id="score" class="ng-binding">
                                                
                                            </div>
                                        </div>
                                    </div>
                                </div>
                        </div> 
                </div>
<script>
//keyboard
var keyboard = new THREEx.KeyboardState();
var clock = new THREE.Clock();

//collision vars
var MovingCube;
var collidableMeshList = []; 
       
//updater
var updateFcts = [];
//scene
var scene = new THREE.Scene();
//fog
scene.fog = new THREE.FogExp2( 0xd0e0f0, 0.0025 );
//renderer
var renderer = new THREE.WebGLRenderer( { antialias: false } );
//window
canvasWidth = 800;
canvasHeight = 400;
renderer.setSize( canvasWidth, canvasHeight );
        
//append object to it
document.getElementById("customcanvas").appendChild(renderer.domElement);

//camera
var camera = new THREE.PerspectiveCamera(45, canvasWidth / canvasHeight, 0.01, 5700);
camera.position.y = 102;
camera.position.z = 15;
camera.position.x = -61;

//lighting
var light = new THREE.HemisphereLight( 0xfffff0, 0x101020, 1.25 );
light.position.set( 0.75, 1, 0.25 );
scene.add( light );

//plane                
var plane = new Plane();
scene.add(plane);

//skybox
var skyBox = new Skybox();
scene.add( skyBox );

//moving cube
var cubeGeometry = new THREE.CubeGeometry(5,10,5,1,1,1);
var wireMaterial = new THREE.MeshBasicMaterial( { color: 0xff0000, wireframe:true } );
MovingCube = new THREE.Mesh( cubeGeometry, wireMaterial );
MovingCube.position.set(camera.position.x, camera.position.y, camera.position.z);
scene.add( MovingCube );
        
//Camera Controls
var controls = new THREE.FirstPersonControls( camera );
controls.movementSpeed = 80;
controls.lookSpeed = 0.05;
controls.lookVertical = false; //if true vertical look on mousemovement
updateFcts.push(function(delta, now){
                controls.update( delta );                
        })

//city buildings
BuildingMaker();

//Locking the pointer to the game
document.getElementById("customcanvas").addEventListener( 'click', function ( event ) {
        lock();
}, false );
function lock(rawr) {
        document.getElementById("customcanvas").requestPointerLock();
} 

//economy variables
var leftOverAmmo =23;
var totalAmmo =50;
var eAmmo = leftOverAmmo+"/"+totalAmmo;
var eWeapon ="Pistol";
var totalscore = 0;
var eScore ="Score: "+totalscore;
//show HUD economy functions
function appendAmmo()
{   document.getElementById('ammo').innerHTML = eAmmo;}
function appendWeapon()
{   document.getElementById('weapon').innerHTML = eWeapon;}
function appendScore()
{   document.getElementById('score').innerHTML = eScore;}

//hit registration collision
function clearText()
{   document.getElementById('message').innerHTML = '.....';}

function appendText(txt)
{   document.getElementById('message').innerHTML += txt;}

        //update function
        updateFcts.push(function(){
                //render the scene
                renderer.render( scene, camera ); 
                //collision detection
                Collide();
                //economy HUD
                appendAmmo();
                appendWeapon();
                appendScore();
        })
        
        //loop runner
        var lastTimeMsec= null
        requestAnimationFrame(function animate(nowMsec){
                // keep looping
                requestAnimationFrame( animate );
                // measure time
                lastTimeMsec = lastTimeMsec || nowMsec-1000/60
                var deltaMsec = Math.min(200, nowMsec - lastTimeMsec)
                lastTimeMsec = nowMsec
                // call each update function
                updateFcts.forEach(function(updateFn){
                        updateFn(deltaMsec/1000, nowMsec/1000)
                })
        })
</script>
</div>
<div id="message"></div>
<p class="ce">Use Q, E keys to rotate the camera</p>
<p class="ce">Use the W, A, S, D keys to move around</p>
<p class="ce">WebGL renderer is supported in Firefox 4+, Chrome 9+, and Safari 6+</p>
<!--external sounds-->
<!--<audio autoplay loop><source src="sound/gangsters2.mp3" type="audio/mp3"></audio>-->
</body>
</html>