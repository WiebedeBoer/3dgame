<!DOCTYPE html>
<html>
    <head>
        <!--Meta-->
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <!--three.js-->
        <script src="three.js"></script>
        <!--camera controls-->
        <script src="FPControls.js"></script>
        <!--open xml-->
        <script src="openxml.js"></script>
        <!--buildings tenements, commercials, factories-->
        <script src="Buildings/tenements.js"></script>
        <script src="Buildings/commercials.js"></script>
        <script src="Buildings/factories.js"></script>
        <!--buildings-->
        <script src="Buildings/dpstore.js"></script>
        <script src="Buildings/lbanks.js"></script>
        <script src="Buildings/lhotels.js"></script>
        <script src="Buildings/npapers.js"></script>
        <script src="Buildings/radios.js"></script>
        <script src="Buildings/stations.js"></script>
        <script src="Buildings/movtheatres.js"></script>
        <script src="Buildings/museums.js"></script>
        <script src="Buildings/schools.js"></script>
        <script src="Buildings/university.js"></script>
        <script src="Buildings/orphanage.js"></script>
        <script src="Buildings/churches.js"></script>
        <script src="Buildings/synagogue.js"></script>
        <script src="Buildings/policedep.js"></script>
        <script src="Buildings/firedep.js"></script>
        <script src="Buildings/fbi.js"></script>
        <script src="Buildings/jail.js"></script>
        <script src="Buildings/hospitals.js"></script>
        <script src="Buildings/court.js"></script>
        <script src="Buildings/cityhall.js"></script>
        <script src="Buildings/postoffices.js"></script>
        <script src="Buildings/warehouses.js"></script>
        <!--Enemy-->
        <script src="Enemy/enemy.js"></script>
        <!--Graph-->
        <script src="Graph.js"></script>
        <!--test depot-->
        <script src="Depot.js"></script>
        <!--plane-->
        <script src="Plane.js"></script>
        <!--skybox-->
        <script src="Skybox.js"></script>
        <!--loaders-->
        <script src="OBJLoader.js"></script>
        <script src="MTLLoader.js"></script>
        <script src="DDSLoader.js"></script>
        <script src="ModelLoader.js"></script>
        <!--collission detection-->
        <script src="Collision.js"></script>
        <style>
            .customcanvas {margin-left: auto; margin-right: auto; margin-top: 20px; width: 1200px; height: 600px; display: block;
            border-style: solid; border-width: 3px; border-color: #000000;}
            p.ce {text-align: center;}
        </style>
    </head>
    <body style="margin: 0px; background-color: #ffffff; overflow: hidden;">
        <div height="400" width="800" class="customcanvas" id="customcanvas">
        <script>

            // Updater
            var updateFcts = [];

            // Scene
            var scene = new THREE.Scene();

            // Fog
            scene.fog = new THREE.FogExp2( 0xd0e0f0, 0.0025 );

            // Renderer
            var renderer = new THREE.WebGLRenderer( { antialias: false } );

            // Canvas
            canvasWidth = 1200;
            canvasHeight = 600;
            renderer.setSize( canvasWidth, canvasHeight );

            // Append Object
            document.getElementById("customcanvas").appendChild(renderer.domElement);

            // Camera
            var camera = new THREE.PerspectiveCamera(45, canvasWidth / canvasHeight, 0.01, 8000);
            camera.position.y = 12;
            camera.position.z = 15;
            camera.position.x = 15;

            // Lighting
            var light = new THREE.HemisphereLight( 0xfffff0, 0x101020, 1.25 );
            light.position.set( 0.75, 1, 0.25 );
            scene.add( light );

            // Plane
            var plane = new Plane();
            scene.add(plane);

            // Skybox
            var skyBox = new Skybox();
            scene.add( skyBox );

            // Camera Controls
            var controls = new THREE.FirstPersonControls( camera );
            controls.movementSpeed = 80;
            controls.lookSpeed = 0.05;
            controls.lookVertical = false;
            updateFcts.push(function(delta, now){
                            controls.update( delta );
            })

            // Depot
            var ndepot = new Depot();
            scene.add(ndepot);

            // Enemy
            var enemy = new Enemy();
            scene.add(enemy);
            function AnimateEnemy() {
                var distance = 5;
                enemy.transform.position = enemy.transform.position + Camera.main.transform.forward * distance * Time.deltaTime;
                enemy.lookAt(camera.position);
            }

            // DPStore
            var dpstore = new DepartmentStore();
            scene.add(dpstore);

            updateFcts.push(function(){
                renderer.render(scene, camera);
                AnimateEnemy();
            })
            var lastTimeMsec= null
            requestAnimationFrame(function animate(nowMsec){
                requestAnimationFrame( animate );
                lastTimeMsec = lastTimeMsec || nowMsec-1000/60
                var deltaMsec = Math.min(200, nowMsec - lastTimeMsec)
                lastTimeMsec = nowMsec
                updateFcts.forEach(function(updateFn){
                    updateFn(deltaMsec/1000, nowMsec/1000)
                })
            })
        </script>
        </div>
        <div>
            <p class="ce">Use Q, E keys to rotate the camera</p>
            <p class="ce">Use the W, A, S, D keys to move around</p>
            <p class="ce">WebGL renderer is supported in Firefox 4+, Chrome 9+, and Safari 6+</p>
        </div>
    </body>
</html>
